#!/bin/bash

IMGPATH=$HOME/Pictures/Wal/bgr

help_message() {
	cat << EOH
Usage: bgset [OPTION]
Set and restore backgrounds and color schemes using feh, pywal and splash-cli.

Options:
  -n --new new               Get a new background from Unsplash
  -c --collection            Set the collection to use

  -r --restore restore       Restore background 


Requires feh, pywal and splash-cli to be in path.

EOH

	exit 1
} 

restore() {
  # Set the image
  IMG=$IMGPATH*
  
  # Set our color scheme
  wal -i $IMG -n

  # Import our Xresources
  xrdb ~/.config/X11/xresources
  
  # Set our wallpaper
  feh --no-fehbg --bg-fill $IMG
}

new(){
  # Remove the old image
  rm -rf $IMGPATH*

  # Pick a random path to save the file to
  IMG=$IMGPATH$RANDOM$RANDOM.jpg
  
  # Get a new image
  splash --collection "$COLLECTION" --save $IMG
}

[[ $# -eq 0 ]] && help_message

while test $# != 0
do
	case "$1" in
	-n | --new | new) NEW=1 ;;
	-r | --restore | restore) RESTORE=1 ;;
        -c | --collection ) COLLECTION=$2; shift ;;
	*) help_message ;;
	esac
	shift
done


[[ NEW -eq 1 ]] && new && restore && RESTORE=0

[[ RESTORE -eq 1 ]] && restore

exit 0
